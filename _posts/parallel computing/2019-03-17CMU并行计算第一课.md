### 什么是并行计算

在CMU15418中我们提到了并行计算，但是在CMU15213这门课中我们同样也提到了服务器的多线程并发，这两者有什么区别呢？其实这个问题就是并行和并发两者的区别和联系。其实并行就是一种并发，我们定义并发的条件比较宽松，即在某一个是时间段内有两个或两个以上的进程/线程在运算的话，我们就成为并发。但是并行的条件明显就要严苛多，它要求处理器的有多个核心，而且在同一时刻（注意不是时间段哦）有两个或者两个以上的进程/线程同时运行。

### 三个Demo的启发：

1、进程或者线程之间的通信成本会限制程序的加速比，因此我们要尽量将通信成本降低。

2、如果不同的进程或者线程处理的工作量不同也会限制程序的加速比（一核有难，八核围观），所以在并行计算中要分配好任务。

3、如果调用大量的进程或者线程来进行计算的话，会导致程序通信的时间远远大于真正计算的时间。

### 课程主题1

**学会并行的思考**

1、将任务安全的分割成若干份，然后再进行安全的并行执行。

2、将任务传给处理器进行处理。

3、要管理好不同处理器之间的通信和同步成本。

**抽象和机制（abstraction和mechanism）**

关于抽象和机制后面穿插与整门课程，要注意区分。并且我们要学会如何去编写以及调试并行的代码。

### 课程主题2

我们要了解硬件是如何支持并行计算的。

1、了解一些硬件实现的性能特性。

2、设计的trade-off：性能-便利-成本

**为什么了解硬件的特性**

因为硬件的特性对程序的性能影响特别大，我们会在后面看到GPU的一些调优内容，如果不掌握硬件特性的话，那比较难理解一些调优的trick。

### 为什么要采用并行计算

在20世纪之前，其实我们大可不必太关心并行计算。因为当时有“免费的午餐”，因为我们可以提高指令级并行(ILP)和CPU的时钟频率来提高程序的性能。因为之前整个半导体行业都是遵循摩尔定律的。但是进入本世纪以来，人们发现提高指令级并行和CPU时钟频率越来越难了，因此各大芯片厂商将芯片做成多核处理器来提高程序的性能，因此这就需要程序员要掌握相应的并行编程的技术。

### Instruction level parallelism(ILP)

其实CPU自己会偷偷的利用指令级并行来提高程序运行的速度，但是这个并行是隐式并行的，程序员式观察不到的。

**如何实现指令级并行**

在CPU中一般的指令必须是有序执行的，但是一些独立的指令可以并行执行，指令级并行就是让一些独立且互相不影响的指令同时运行。

**Superscalar执行**

处理器会在指令流中动态的寻找独立的指令，然后将这些独立的指令并行的执行。

![1552748479503](C:\Users\yupei\AppData\Local\Temp\1552748479503.png)

从上图可以看到，如果我们提高指令级并行之后，加速比不一定会增加，从这张图中看出该处理器一个时钟周期处理4条指令可以得到比较好的加速比，但是超过4之后的加速比并不会增加。

### 能量墙

现代处理器的时钟频率并不能继续提高的一个重要原因是存在能量墙，因为继续提高时钟频率会给功耗以及散热带来巨大的问题。其实功率是在处理器设计上面要着重考虑的一个因素，它的重要性不亚于处理器的性能和价格。

### 影响单核性能的两大因素

1、由于功耗的问题，处理器时钟频率并不能继续提高了。

2、ILP也没有那么好使了，因为增加ILP会给硬件设计以及指令设计带来非常多的困难。

所以对于软件开发者来说，天下已经没有免费的午餐了，现在的处理器一般是怼了好多核然后进行并行计算。









